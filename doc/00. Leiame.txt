GeoSan - Notas de Liberação
Versão para Windows

27-11-2012 - GeoSan 06.00.07.09
Verificado na consulta de endereços que quando uma coluna vem com valor nulo e soma a outras colunas contendo valores no SQLServer, o valor final fica nulo.
Desta forma na tabela GS_QUERYS_CLIENT, coluna QUERY_ID = 2, esta foi modificada de:

SELECT LI."NRO_LIGACAO", LI."CLASSIFICACAO_FISCAL", LI."TIPO", LI."ENDERECO"  + ' - ' + LI."NUM_CASA" + ' - ' + LI."BAIRRO" As ENDERECO, LI."COMPL_LOGRADOURO" As COMPLEMENTO, LI."CONSUMIDOR",  LI."COD_LOGRADOURO" as "CODLOGRAD" FROM "NXGS_V_LIG_COMERCIAL" LI WHERE (LI."NRO_LIGACAO" in (@NRO_LIGACAO))

para

SELECT LI."NRO_LIGACAO", LI."CLASSIFICACAO_FISCAL", LI."TIPO", ISNULL( LI."ENDERECO",'')  + ' - ' + ISNULL(LI."NUM_CASA",'') + ' - ' + ISNULL( LI."BAIRRO",'') As ENDERECO, LI."COMPL_LOGRADOURO" As COMPLEMENTO, LI."CONSUMIDOR",  LI."COD_LOGRADOURO" as "CODLOGRAD" FROM "NXGS_V_LIG_COMERCIAL" LI WHERE (LI."NRO_LIGACAO" in (@NRO_LIGACAO))

a comparação ISNULL, substitui o nulo por '' o que faz a coluna ENDERECO aparecer com os respecitivos dados quando uma das colunas conter valores nulos.

Foi alterada a template do banco de dados SQLServer

27-11-2012 - GeoSan 06.00.07.08
Atualizada rotina que gerencia erros no ValidaBase para que indique de forma mais apropriada quando não encontra o banco de dados na rede.
Atualizada rotina que gerencia erros no GeoSan para que indique de forma apropriada a localização do arquivo de erros.


27-11-2012 - GeoSan 06.00.07.07
O arquivo 00. Leiame.txt foi unificado. Ele é registrado inicialmente na pasta doc e copiado, quando finalizado, para a de instalação em \install\GeraSetupGeoSan\ArquivosInstGeoSan


27-11-2012 - GeoSan 06.00.07.07
Atualizada a subrotina Main() onde foi colocado o número da versão atual no início da mesma, facilitando a alteração da mesma para cada modificação.
Foi formatado o código (tabulações) para que ficasse mais legível.


27-11-2012 - GeoSan 06.00.07.07
Verificou-se que ao selecionar Arquivo-Atualizar Consumos e Distribuir Demandas, e selecionar Atualizar com o Consumo Médio das Ligações cadastradas, que a querie demorava muito para processar.
Ao investigar o motivo verificou-se que no processamento da querie abaixo que acessa a vista do sistema comercial, NXGS_V_LIG_COM_CONSUMO_MEDIO, que a coluna NRO_LIGACAO provavelmente não possui índice o que acarreta uma grande demora no processamento, aparecendo uma mensagem de erro indicando time-out.

UPDATE RAMAIS_AGUA_LIGACAO SET CONSUMO_LPS = (NXGS_V_LIG_COM_CONSUMO_MEDIO.CONSUMO_MEDIO * 0.00038580246) FROM NXGS_V_LIG_COM_CONSUMO_MEDIO WHERE RAMAIS_AGUA_LIGACAO.NRO_LIGACAO = NXGS_V_LIG_COM_CONSUMO_MEDIO.NRO_LIGACAO

Desta forma a querie foi alterada, retirando-se o digito verificador da coluna RAMAIS_AGUA_LIGACAO da tabela do GeoSan RAMAIS_AGUA_LIGACAO, dividindo-se por 10 e utilizamos a coluna da vista do sistema comercial NXGS_V_LIG_COM_CONSUMO_MEDIO.NRO_LIGACAO_SEM_DV, a qual não possui o dígito verificador.

UPDATE RAMAIS_AGUA_LIGACAO SET CONSUMO_LPS = (NXGS_V_LIG_COM_CONSUMO_MEDIO.CONSUMO_MEDIO * 0.00038580246) FROM NXGS_V_LIG_COM_CONSUMO_MEDIO WHERE RAMAIS_AGUA_LIGACAO.NRO_LIGACAO / 10 = NXGS_V_LIG_COM_CONSUMO_MEDIO.NRO_LIGACAO_SEM_DV

Desta forma ela processou em menos de um minuto. Provavelmente o dígito verificador estava sendo calculado para cada número de ligação na vista do sistema comercial e isso causava lentidão.

Foi alterada a rotina de erro, para que apresente o erro encontrado de forma mais completa, auxiliando assim o progamador a localizar a razão da ocorrência do mesmo.

É necessário corrigir e testar estas queries para os outros bancos de dados Oracle e Postgres, conforme tabelas comerciais dos demais clientes.

Para testar esta correção foi zerado o consumo com a querie (SQL Management):
UPDATE RAMAIS_AGUA_LIGACAO SET CONSUMO_LPS = 0 
Consultados os consumos para verificar se estavam zerados mesmo com a querie:
SELECT TOP 1000 [OBJECT_ID_]
      ,[NRO_LIGACAO]
      ,[INSCRICAO_LOTE]
      ,[AUTO]
      ,[CONSUMO_LPS]
      ,[TIPO]
      ,[ECONOMIAS]
      ,[HIDROMETRADO]
  FROM [valinhosgeosan].[dbo].[RAMAIS_AGUA_LIGACAO]
Rodado o GeoSan com a função Arquivo-Atualizar Consumos e Distribuir Demandas, e seleção da opção Atualizar com o Consumo Médio das Ligações cadastradas.
E consultados os consumos novamente com a mesma querie acima, para verificar as modificações.

Para testar a o funcionamento da retirada do último dígito verificador do número da ligação, foi rodada a querie:
SELECT TOP 10 CONSUMO_LPS, NRO_LIGACAO/10, NRO_LIGACAO FROM RAMAIS_AGUA_LIGACAO

23-11-2012 - GeoSan 06.00.07.07
Na consulta de ligações associadas aos ramais de água foi retirada a consulta por lotes. No banco de dados na tabela GS_QUERYS_CLIENT, coluna QUERY_ID = 2 pmde QUERYSTRING é:
A palavra endereço estava também com cedilha como ENDEREÇO, o que causava erro.
SELECT LI."NRO_LIGACAO", LI."CLASSIFICACAO_FISCAL", LI."TIPO", LI."ENDERECO"  + ' - ' + LI."NUM_CASA" + ' - ' + LI."BAIRRO" As ENDERECO, LI."COMPL_LOGRADOURO" As COMPLEMENTO, LI."CONSUMIDOR",  LI."COD_LOGRADOURO" as "CODLOGRAD" FROM "NXGS_V_LIG_COMERCIAL" LI WHERE (LI."CLASSIFICACAO_FISCAL" in (@CLASSIFICACAO_FISCAL) OR LI."NRO_LIGACAO" in (@NRO_LIGACAO))
mudado para
SELECT LI."NRO_LIGACAO", LI."CLASSIFICACAO_FISCAL", LI."TIPO", LI."ENDERECO"  + ' - ' + LI."NUM_CASA" + ' - ' + LI."BAIRRO" As ENDERECO, LI."COMPL_LOGRADOURO" As COMPLEMENTO, LI."CONSUMIDOR",  LI."COD_LOGRADOURO" as "CODLOGRAD" FROM "NXGS_V_LIG_COMERCIAL" LI WHERE (LI."NRO_LIGACAO" in (@NRO_LIGACAO))


04-10-2012 - GeoSan 06.00.07.05

Foi realizada a revisão no código no formulário FrmCadastroRamal, colocados diversos comentários.
Foi alterada uma linha no banco de dados. Consultar o arquivo db\historico de alteracoes banco de dados.txt
Corrigida a questão de acesso dos consumidores em banco local, que não estava acessando. 

04-09-2012 - GeoSan 06.00.07.04
Atualizada a querie que distribui as demandas de consumo médio do software comercial para os ramais das ligações de água.
Gerado novo executável para instalação do GeoSan.

03-09-2012 - GeoSan 06.00.07.03
Atualizada a querie que distribui o consumo médio nos ramais
A mesma continha um innerJoin que não era necessário e tornava
a execução da mesma mais lenta.



Geosan 6.0.7 - Notas de Liberação
Versão para Windows

10/02/2012


1. PRÉ-REQUISITOS DE INSTALAÇãO

Você deve atender os seguintes requisitos para realizar a instalação do GeoSan:

1.1. Sistema operacional Windows XP Professional (SP3)

1.2. Fechar todos os programas e desabilitar o software antivirus que estejam em funcionamento, antes de começar a instalação, habilitando-os novamente somente após o término da instalação.

1.3. Possuir privilégios administrativos no sistema operacional da máquina cliente onde instalará o GeoSan.

2. PROCEDIMENTOS PARA INSTALAÇÃO


Instale os componentes e softwares na seguinte ordem:

	1 - Instalar o aplicativo: - WindowsInstaller 3.1-v2-x86.exe (Caso o computador já tenha uma versão mais recente
deste aplicativo, é lançado uma mensagem de erro que é normal.)

        2 - Instalar o aplicativo: - Vcredist_x86.exe

	3 - Instalar o aplicativo: - Componente C++ Geosan.exe

	4 - Desinstalar todas as versoções do Terracomponents (Painel de controle), caso ja exista. 
	    Instalar o aplicativo: - TerraComponents 3.3.1.13.msi

        5 - Instalar o aplicativo: - MDAC_TYP.EXE


	6 - Instalar o aplicativo: - Instalador Geosan 6.0.7.exe 

       

	7 - Configurar permissões totais de Escrita/Leitura/Gravação na pasta do Geosan (C:\Arquivos de Programas\Geosan) para todos usuários logados.




3. EXECUÇÃO DO GEOSAN

	1 - Iniciar o GeoSan pelo atalho da área de trabalho.	

	2 - Caso seja a primeira instalação do Geosan no computador, aparecerá uma mensagem informando que não 
	    encontrou o banco de dados. Selecione Ok.

	2.1 - Aparecerá uma caixa de diálogo perguntando onde está o banco de dados.
		a. Selecionar tipo de conexão como: SQLServer
		b. Digitar o nome do banco
		c. Digitar o nome do servidor
		d. Digitar o nome do usuário
		e. Digitar a senha

	3. Entre com o nome do usuário administrador e senha do GeoSan:
	Usuário: Administrador
	Senha: Senha

	4. O sistema irá abrir. Consulte o Manual do Usuário para obter detalhes da operação do sistema.

	
Correções e alterações incluídas de acordo com a versão:

6.0.7 - Correção da função de habilitação do sistema usuário tipo visitante e visualizador

6.0.6 - Correção da função de apresentação das informações do endereço de consumidores na janela de cadastro de ramais.

6.0.5 - Compatibilidade com banco de dados SQLServer 2008

6.0.0   Compatibilidade com o banco de dados Postgresql.

5.9.8   a.) Correção da funcionalidade Localizar Consumidores (Nome), 
	b.) Correção da funcionalidadeEncontrar Válvulas, 
	c.) Correção da funcionalidade Carregar Polígono e Apresentar Consumidores

5.9.7   a.) Correção da funcionalidade de cadastro de redes de drenagem


5.9.6	a.) Corrigida funcionalidade Localizar Válvulas
	
	b.) Habilitada a funcionalidade Localizar Válvulas para o usuário tipo visitante

5.9.5   a.) O uso arquivo Geosan.cfg foi descontinuado. As informações de conexão com o banco de dados são agora lidas do arquivo Geosan.ini.

	b.) A ferramenta Polígono de seleção copia também os OBJECT_ID dos nós de redes de água para a tabela POLIGINO_SELEÇÃO.



5.9.4	a.) Pesquisa de consumidores/ramais pelo número de ligação ou pelo nome do consumidor
	
	b.) Novo relatório de Ramais de Água permitindo que o cliente defina as informações do relatório 

	c.) Filtro no tema de Ramais de Água por Tipo, Hidrometrado, Economias, Consumo LPS, Distância Testada, 
	    Distância Lado, Comprimento Ramal, Profunfidade Ramal ou Usuário

	d.) Definição da escala do mapa através do menu: Mapa > Definir Escala ou digitando a escala diretamente no campo Escala

	e.) Pesquisa automática pelo numreo de IPTU da Geometria do Lote para cadastramento de consumidores
	
	f.) Incorporado o uso de arquivo tipo .ini para salvamento de parâmetros do usuário na máquina

	g.) Usuário tipo visitante pode inserir e consultar documentos

	h.) Cálculo da área formada por 3 ou mais pontos criados através de polígono. Mapa > Calcular Área (m²)
	
	i.) Painel de Status com novas informações:
		Mostra o comprimento da rede ao desenhar
		Mostra o código identificador da rede ao salvar a rede
		Mostra o código identificador do componente ao inserir componente na rede
		Mostra valor da área em m² quando a ferramenta de medição de área é selecionada

	j.) Módulo de Impressão: Correção para permitir ajuste de escala

	k.) Módulo de Impressão: Correção para exibir temas com limite de exibição maior que zero



5.9.3	a.) Reabilitada a função de exportar imagens;
	
	b.) Reabilitada a função de localização de textos;
	
	c.) Modificado código incluindo tratamento de erro diferenciado na função de atualização automática da base de dados.



5.9.2	a.) Cadastramento de Ramais de Esgoto;

	b.) Possibilidade de salvar o mapa ativo como figura nos formatos BMP, GIF, JPG, PNG ou TIF;
	
	c.) Módulo de impressão:
	    Possibilidade de impressão de mapas e figuras nos formatos A0, A1, A2, A3, A4 e A5.



5.9.0	a.) Novo relatório indicador de produtividade de Rede de Esgoto
	
	b.) Peças de Redes de Esgoto:
	    Modificada a quantidade de campos utilizada no cálculo da diferença de Cota Terreno e Cota Profundidade PV
	    Agora está limitada a 3 casas depois do ponto decimal e após esse valor ocorre arredendamento do valor.

	c.) Nova funcionalidade no desenho de redes de água e esgoto para não permitir o desenho de uma rede sobre 
	    outra rede com mesma peça inicial e mesma peça final.



